var actionhandler=function(t){"use strict";var e=document.getElementById("editor")||document.querySelector("textarea"),n=[],a=[];e.addEventListener("keydown",(function(t){s.selection={start:t.target.selectionStart,end:t.target.selectionEnd},s.selection_length?s.lostData=e.value.slice(s.selection.start,s.selection.end):s.lostData=e.value.slice(s.selection.start-1,s.selection.end+1)})),e.addEventListener("paste",(t=>{s.data=(window.clipboardData||t.clipboardData).getData("text/plain"),s.data=s.data.replace(/\r\n/g,"\n")})),e.addEventListener("input",(t=>{if("historyUndo"==t.inputType)return console.log(t.inputType),t.preventDefault(),!1;s.type=t.inputType,s.type!==r.insertFromPaste&&(s.data=t.data),s.selection_length?s.selection.end=s.selection.start:s.type==r.deleteContentBackward?(s.selection.start--,s.selection.end--,s.lostData=s.lostData[0]):s.type==r.deleteContentForward?s.lostData=s.lostData[1]:s.type!=r.insertText&&s.type!=r.insertFromPaste||(s.lostData=s.lostData.slice(1,-1)),n.push(Object.assign({},s)),"historyUndo"!=t.inputType&&a.splice(0,a.length)}));const s={type:null,data:null,lostData:null,get selection_length(){return this.selection.end-this.selection.start},selection:{start:null,end:null}};function l(t,n){if(Boolean(n)!==Boolean("redo"))var a=t.lostData,s=t.data;else s=t.lostData,a=t.data;switch(t.type){case"insertFromPaste":e.value=e.value.substring(0,t.selection.start)+a+e.value.substring(t.selection.start+s.length),e.setSelectionRange(t.selection.start,t.selection.end+a.length),t.caret&&(e.selectionStart=e.selectionEnd);break;case"insertText":t.selection_length||(e.value=e.value.substring(0,t.selection.start)+(a||"")+e.value.substring(t.selection.start+(s||"").length)),e.setSelectionRange(t.selection.start+a.length,t.selection.end+a.length);break;case"deleteByCut":case"deleteContentForward":case"deleteContentBackward":e.value=e.value.substring(0,t.selection.start)+(a||"")+e.value.substring(t.selection.end+!!n*(s||"").length),e.selectionStart=e.selectionEnd=t.selection.start+(t.type==r.deleteContentBackward&&1==(a||"").length),(a||"").length>1&&(e.selectionEnd=t.selection.start+a.length)}}const r={insertFromPaste:"insertFromPaste",deleteByCut:"deleteByCut",insertText:"insertText",deleteContentBackward:"deleteContentBackward",deleteContentForward:"deleteContentForward"};return t.default=function(t){e=t},t.input=s,t.storeAction=function(t,e,n){t.target.selectionStart=n.startLine+1,t.target.selectionEnd=n.endLine,t.target.dispatchEvent(new KeyboardEvent("keydown",{}));let a=e(t),l=new DataTransfer;l.setData("text/plain",t.target.value.substr(n.startLine+1,a.line.length));let r=new ClipboardEvent("paste",{clipboardData:l});return t.target.dispatchEvent(r),s.caret=123,t.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),s.caret=void 0,a},t.storeMultiactions=function(t,e,n){t.target.dispatchEvent(new KeyboardEvent("keydown"));let a=e(t),s=new DataTransfer;s.setData("text/plain",t.target.value.slice(t.target.selectionStart,t.target.selectionEnd));let l=new ClipboardEvent("paste",{clipboardData:s});t.target.dispatchEvent(l),t.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),n&&a&&void 0!==a.backoffset&&n(a)},t.undo=t=>{if(t.shiftKey)return(t=>{let e=a.pop();e&&(n.push(e),l(e,"redo"),t.preventDefault())})(t);let e=n.pop();e&&(a.push(e),l(e,""),t.preventDefault())},t}({});
